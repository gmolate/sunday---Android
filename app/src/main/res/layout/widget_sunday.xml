<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/widget_container"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="8dp"
    android:clickable="true"
    android:focusable="true"
    android:background="@drawable/widget_background">

    <TextView
        android:id="@+id/current_uv"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_centerInParent="true"
        android:textSize="24sp"
        android:textColor="#FFFFFF"
        android:textStyle="bold"/>

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_below="@id/current_uv"
        android:layout_centerHorizontal="true"
        android:text="UV Index"
        android:textColor="#FFFFFF"/>

</RelativeLayout>

import android.appwidget.AppWidgetManager
import android.appwidget.AppWidgetProvider
import android.content.Context
import android.widget.RemoteViews
import com.gmolate.sunday.R
import com.gmolate.sunday.model.AppDatabase
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch

class SundayWidget : AppWidgetProvider() {
    override fun onUpdate(
        context: Context,
        appWidgetManager: AppWidgetManager,
        appWidgetIds: IntArray
    ) {
        CoroutineScope(Dispatchers.IO).launch {
            val db = AppDatabase.getDatabase(context)
            val cachedData = db.cachedUVDataDao().getLatestData()

            appWidgetIds.forEach { appWidgetId ->
                val views = RemoteViews(context.packageName, R.layout.widget_sunday)

                cachedData?.let {
                    views.setTextViewText(R.id.current_uv, String.format("%.1f", it.maxUV))
                }

                appWidgetManager.updateAppWidget(appWidgetId, views)
            }
        }
    }
}
